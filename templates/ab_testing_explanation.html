{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Understanding A/B Testing for Recommendation Systems</h1>
    
    <div class="row mb-5">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">What is A/B Testing?</h3>
                    <p class="card-text">
                        A/B testing (also known as split testing) is a method of comparing two or more versions of a system to determine which one performs better. Users are randomly assigned to different variants, and various metrics are collected to evaluate performance.
                    </p>
                    <p>
                        In our recommendation system, A/B testing allows us to experiment with different weighting configurations for our recommendation algorithms to find the optimal mix that provides the best user experience and business outcomes.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <i class="fas fa-flask fa-5x text-primary mb-3"></i>
                    <h4>Experimentation</h4>
                    <p>Testing different hypotheses in a controlled environment with real user feedback</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3>How Our A/B Testing Works</h3>
                </div>
                <div class="card-body">
                    <div class="row align-items-center mb-4">
                        <div class="col-md-6">
                            <h4>Step 1: Create Test Variants</h4>
                            <p>
                                Each A/B test consists of multiple variants of our recommendation system. Each variant uses different weights for the three recommendation algorithms:
                            </p>
                            <ul>
                                <li><strong>Content-Based Filtering:</strong> Recommends products similar to ones you've liked</li>
                                <li><strong>Collaborative Filtering:</strong> Recommends products liked by similar users</li>
                                <li><strong>Neural Collaborative Filtering:</strong> Uses deep learning to model complex patterns</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <!-- SVG for Test Variants -->
                            <svg width="100%" height="300" viewBox="0 0 600 300" xmlns="http://www.w3.org/2000/svg">
                                <!-- Title -->
                                <text x="300" y="30" font-size="18" font-weight="bold" text-anchor="middle">Test Variants Configuration</text>
                                
                                <!-- Control Group -->
                                <rect x="50" y="60" width="150" height="200" rx="10" fill="#f8f9fa" stroke="#343a40" stroke-width="2"/>
                                <text x="125" y="85" font-size="16" font-weight="bold" text-anchor="middle">Control Variant</text>
                                
                                <!-- Control Weights -->
                                <rect x="70" y="100" width="110" height="30" rx="5" fill="#17a2b8" opacity="0.7"/>
                                <rect x="70" y="135" width="60" height="30" rx="5" fill="#28a745" opacity="0.7"/>
                                <rect x="70" y="170" width="80" height="30" rx="5" fill="#dc3545" opacity="0.7"/>
                                
                                <text x="125" y="120" font-size="12" fill="white" text-anchor="middle">Content-Based: 30%</text>
                                <text x="100" y="155" font-size="12" fill="white" text-anchor="middle">Collab: 20%</text>
                                <text x="110" y="190" font-size="12" fill="white" text-anchor="middle">Neural: 50%</text>
                                
                                <!-- Test Variant A -->
                                <rect x="230" y="60" width="150" height="200" rx="10" fill="#f8f9fa" stroke="#343a40" stroke-width="2"/>
                                <text x="305" y="85" font-size="16" font-weight="bold" text-anchor="middle">Variant A</text>
                                
                                <!-- Variant A Weights -->
                                <rect x="250" y="100" width="90" height="30" rx="5" fill="#17a2b8" opacity="0.7"/>
                                <rect x="250" y="135" width="90" height="30" rx="5" fill="#28a745" opacity="0.7"/>
                                <rect x="250" y="170" width="30" height="30" rx="5" fill="#dc3545" opacity="0.7"/>
                                
                                <text x="295" y="120" font-size="12" fill="white" text-anchor="middle">Content-Based: 50%</text>
                                <text x="295" y="155" font-size="12" fill="white" text-anchor="middle">Collab: 40%</text>
                                <text x="265" y="190" font-size="12" fill="white" text-anchor="middle">Neural: 10%</text>
                                
                                <!-- Test Variant B -->
                                <rect x="410" y="60" width="150" height="200" rx="10" fill="#f8f9fa" stroke="#343a40" stroke-width="2"/>
                                <text x="485" y="85" font-size="16" font-weight="bold" text-anchor="middle">Variant B</text>
                                
                                <!-- Variant B Weights -->
                                <rect x="430" y="100" width="30" height="30" rx="5" fill="#17a2b8" opacity="0.7"/>
                                <rect x="430" y="135" width="30" height="30" rx="5" fill="#28a745" opacity="0.7"/>
                                <rect x="430" y="170" width="90" height="30" rx="5" fill="#dc3545" opacity="0.7"/>
                                
                                <text x="445" y="120" font-size="12" fill="white" text-anchor="middle">Content: 10%</text>
                                <text x="445" y="155" font-size="12" fill="white" text-anchor="middle">Collab: 10%</text>
                                <text x="475" y="190" font-size="12" fill="white" text-anchor="middle">Neural: 80%</text>
                                
                                <!-- Legend -->
                                <rect x="180" y="240" width="15" height="15" fill="#17a2b8" opacity="0.7"/>
                                <text x="200" y="253" font-size="12" text-anchor="start">Content-Based</text>
                                
                                <rect x="300" y="240" width="15" height="15" fill="#28a745" opacity="0.7"/>
                                <text x="320" y="253" font-size="12" text-anchor="start">Collaborative</text>
                                
                                <rect x="420" y="240" width="15" height="15" fill="#dc3545" opacity="0.7"/>
                                <text x="440" y="253" font-size="12" text-anchor="start">Neural</text>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="row align-items-center mb-4">
                        <div class="col-md-6 order-md-2">
                            <h4>Step 2: Assign Users to Variants</h4>
                            <p>
                                When a user visits the site, they are randomly assigned to one of the test variants. The system then uses the weights from that variant to generate recommendations for that user.
                            </p>
                            <p>
                                This assignment ensures that each user consistently experiences the same variant throughout the test period, allowing us to accurately measure the impact.
                            </p>
                        </div>
                        <div class="col-md-6 order-md-1">
                            <!-- SVG for User Assignment -->
                            <svg width="100%" height="280" viewBox="0 0 600 280" xmlns="http://www.w3.org/2000/svg">
                                <!-- Title -->
                                <text x="300" y="30" font-size="18" font-weight="bold" text-anchor="middle">User Assignment to Variants</text>
                                
                                <!-- Users -->
                                <circle cx="100" cy="100" r="30" fill="#6c757d" stroke="#343a40" stroke-width="2"/>
                                <circle cx="100" cy="180" r="30" fill="#6c757d" stroke="#343a40" stroke-width="2"/>
                                <circle cx="100" cy="240" r="30" fill="#6c757d" stroke="#343a40" stroke-width="2"/>
                                
                                <text x="100" y="105" font-size="14" fill="white" text-anchor="middle">User 1</text>
                                <text x="100" y="185" font-size="14" fill="white" text-anchor="middle">User 2</text>
                                <text x="100" y="245" font-size="14" fill="white" text-anchor="middle">User 3</text>
                                
                                <!-- Assignment Process -->
                                <rect x="200" y="120" width="120" height="80" rx="10" fill="#f8f9fa" stroke="#343a40" stroke-width="2"/>
                                <text x="260" y="160" font-size="14" text-anchor="middle">Random</text>
                                <text x="260" y="180" font-size="14" text-anchor="middle">Assignment</text>
                                
                                <!-- Arrows to assignment -->
                                <line x1="140" y1="100" x2="190" y2="140" stroke="#343a40" stroke-width="2"/>
                                <line x1="140" y1="180" x2="190" y2="160" stroke="#343a40" stroke-width="2"/>
                                <line x1="140" y1="240" x2="190" y2="180" stroke="#343a40" stroke-width="2"/>
                                
                                <!-- Variants -->
                                <rect x="380" y="60" width="120" height="60" rx="10" fill="#f8f9fa" stroke="#007bff" stroke-width="2"/>
                                <rect x="380" y="140" width="120" height="60" rx="10" fill="#f8f9fa" stroke="#28a745" stroke-width="2"/>
                                <rect x="380" y="220" width="120" height="60" rx="10" fill="#f8f9fa" stroke="#dc3545" stroke-width="2"/>
                                
                                <text x="440" y="90" font-size="14" text-anchor="middle">Control</text>
                                <text x="440" y="170" font-size="14" text-anchor="middle">Variant A</text>
                                <text x="440" y="250" font-size="14" text-anchor="middle">Variant B</text>
                                
                                <!-- Arrows from assignment -->
                                <line x1="330" y1="140" x2="370" y2="90" stroke="#343a40" stroke-width="2"/>
                                <line x1="330" y1="160" x2="370" y2="170" stroke="#343a40" stroke-width="2"/>
                                <line x1="330" y1="180" x2="370" y2="240" stroke="#343a40" stroke-width="2"/>
                                
                                <!-- Arrow tips -->
                                <polygon points="370,90 360,85 360,95" fill="#343a40"/>
                                <polygon points="370,170 360,165 360,175" fill="#343a40"/>
                                <polygon points="370,240 360,235 360,245" fill="#343a40"/>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="row align-items-center mb-4">
                        <div class="col-md-6">
                            <h4>Step 3: Collect Metrics</h4>
                            <p>
                                As users interact with the recommendations, we collect various metrics to evaluate performance:
                            </p>
                            <ul>
                                <li><strong>Impressions:</strong> How many times recommendations are shown</li>
                                <li><strong>Clicks:</strong> How many times users click on recommendations</li>
                                <li><strong>Click-Through Rate (CTR):</strong> Percentage of impressions that result in clicks</li>
                                <li><strong>Purchases:</strong> How many times users buy recommended products</li>
                                <li><strong>Conversion Rate:</strong> Percentage of clicks that result in purchases</li>
                                <li><strong>Ratings:</strong> User feedback on recommendation quality</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <!-- SVG for Metrics Collection -->
                            <svg width="100%" height="300" viewBox="0 0 600 300" xmlns="http://www.w3.org/2000/svg">
                                <!-- Title -->
                                <text x="300" y="30" font-size="18" font-weight="bold" text-anchor="middle">Metrics Collection</text>
                                
                                <!-- User Journey -->
                                <rect x="50" y="60" width="120" height="40" rx="5" fill="#f8f9fa" stroke="#343a40" stroke-width="2"/>
                                <text x="110" y="85" font-size="14" text-anchor="middle">User Views Recs</text>
                                
                                <rect x="50" y="130" width="120" height="40" rx="5" fill="#f8f9fa" stroke="#343a40" stroke-width="2"/>
                                <text x="110" y="155" font-size="14" text-anchor="middle">User Clicks Rec</text>
                                
                                <rect x="50" y="200" width="120" height="40" rx="5" fill="#f8f9fa" stroke="#343a40" stroke-width="2"/>
                                <text x="110" y="225" font-size="14" text-anchor="middle">User Purchases</text>
                                
                                <rect x="50" y="270" width="120" height="40" rx="5" fill="#f8f9fa" stroke="#343a40" stroke-width="2"/>
                                <text x="110" y="295" font-size="14" text-anchor="middle">User Rates Rec</text>
                                
                                <!-- Arrows between steps -->
                                <line x1="110" y1="100" x2="110" y2="130" stroke="#343a40" stroke-width="2" stroke-dasharray="5,5"/>
                                <line x1="110" y1="170" x2="110" y2="200" stroke="#343a40" stroke-width="2" stroke-dasharray="5,5"/>
                                <line x1="110" y1="240" x2="110" y2="270" stroke="#343a40" stroke-width="2" stroke-dasharray="5,5"/>
                                
                                <!-- Metrics Collected -->
                                <rect x="240" y="60" width="150" height="40" rx="5" fill="#17a2b8" opacity="0.7"/>
                                <text x="315" y="85" font-size="14" fill="white" text-anchor="middle">Impression +1</text>
                                
                                <rect x="240" y="130" width="150" height="40" rx="5" fill="#17a2b8" opacity="0.7"/>
                                <text x="315" y="155" font-size="14" fill="white" text-anchor="middle">Click +1</text>
                                
                                <rect x="240" y="200" width="150" height="40" rx="5" fill="#17a2b8" opacity="0.7"/>
                                <text x="315" y="225" font-size="14" fill="white" text-anchor="middle">Purchase +1</text>
                                
                                <rect x="240" y="270" width="150" height="40" rx="5" fill="#17a2b8" opacity="0.7"/>
                                <text x="315" y="295" font-size="14" fill="white" text-anchor="middle">Rating Recorded</text>
                                
                                <!-- Arrows to metrics -->
                                <line x1="180" y1="80" x2="230" y2="80" stroke="#343a40" stroke-width="2"/>
                                <line x1="180" y1="150" x2="230" y2="150" stroke="#343a40" stroke-width="2"/>
                                <line x1="180" y1="220" x2="230" y2="220" stroke="#343a40" stroke-width="2"/>
                                <line x1="180" y1="290" x2="230" y2="290" stroke="#343a40" stroke-width="2"/>
                                
                                <!-- Calculated Metrics -->
                                <rect x="450" y="95" width="150" height="40" rx="5" fill="#28a745" opacity="0.7"/>
                                <text x="525" y="120" font-size="14" fill="white" text-anchor="middle">CTR = Clicks/Impressions</text>
                                
                                <rect x="450" y="165" width="150" height="40" rx="5" fill="#28a745" opacity="0.7"/>
                                <text x="525" y="190" font-size="14" fill="white" text-anchor="middle">Conv = Purchases/Clicks</text>
                                
                                <rect x="450" y="235" width="150" height="40" rx="5" fill="#28a745" opacity="0.7"/>
                                <text x="525" y="260" font-size="14" fill="white" text-anchor="middle">Avg Rating = Sum/Count</text>
                                
                                <!-- Arrows to calculated metrics -->
                                <path d="M 400 80 Q 425 105 440 105" stroke="#343a40" stroke-width="2" fill="none"/>
                                <path d="M 400 150 Q 425 175 440 175" stroke="#343a40" stroke-width="2" fill="none"/>
                                <path d="M 400 220 Q 425 245 440 245" stroke="#343a40" stroke-width="2" fill="none"/>
                                <path d="M 400 290 Q 425 265 440 255" stroke="#343a40" stroke-width="2" fill="none"/>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="row align-items-center">
                        <div class="col-md-6 order-md-2">
                            <h4>Step 4: Analyze Results & Optimize</h4>
                            <p>
                                After collecting sufficient data, we analyze the results to determine which variant performs best across key metrics. Statistical significance tests ensure that differences between variants are meaningful.
                            </p>
                            <p>
                                The winning variant can then be automatically applied as the new default weighting configuration for all users, optimizing the recommendation system based on real-world performance.
                            </p>
                        </div>
                        <div class="col-md-6 order-md-1">
                            <!-- SVG for Results Analysis -->
                            <svg width="100%" height="300" viewBox="0 0 600 300" xmlns="http://www.w3.org/2000/svg">
                                <!-- Title -->
                                <text x="300" y="30" font-size="18" font-weight="bold" text-anchor="middle">Results Analysis & Optimization</text>
                                
                                <!-- Chart Visualization -->
                                <rect x="50" y="50" width="500" height="160" rx="5" fill="#f8f9fa" stroke="#343a40" stroke-width="2"/>
                                
                                <!-- Chart Title -->
                                <text x="300" y="75" font-size="14" font-weight="bold" text-anchor="middle">Performance Comparison</text>
                                
                                <!-- X and Y Axes -->
                                <line x1="100" y1="175" x2="500" y2="175" stroke="#343a40" stroke-width="2"/>
                                <line x1="100" y1="175" x2="100" y2="85" stroke="#343a40" stroke-width="2"/>
                                
                                <!-- Bar Chart -->
                                <rect x="150" y="125" width="60" height="50" fill="#6c757d" opacity="0.7"/>
                                <rect x="250" y="100" width="60" height="75" fill="#28a745" opacity="0.7"/>
                                <rect x="350" y="145" width="60" height="30" fill="#dc3545" opacity="0.7"/>
                                
                                <!-- Bar Labels -->
                                <text x="180" y="185" font-size="12" text-anchor="middle">Control</text>
                                <text x="280" y="185" font-size="12" text-anchor="middle">Variant A</text>
                                <text x="380" y="185" font-size="12" text-anchor="middle">Variant B</text>
                                
                                <!-- Significance Star -->
                                <text x="280" y="95" font-size="16" text-anchor="middle" fill="#ffc107" font-weight="bold">â˜…</text>
                                
                                <!-- Optimization Flow -->
                                <line x1="300" y1="220" x2="300" y2="250" stroke="#343a40" stroke-width="2"/>
                                <polygon points="300,250 295,240 305,240" fill="#343a40"/>
                                
                                <!-- Apply Best Variant Box -->
                                <rect x="200" y="250" width="200" height="40" rx="5" fill="#007bff" stroke="#343a40" stroke-width="2"/>
                                <text x="300" y="275" font-size="14" fill="white" text-anchor="middle">Apply Best Variant Weights</text>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h3>Key Benefits of A/B Testing</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                                    <h4>Data-Driven Decisions</h4>
                                    <p>
                                        Replace guesswork with empirical evidence from real user interactions and feedback.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-robot fa-3x text-success mb-3"></i>
                                    <h4>Continuous Improvement</h4>
                                    <p>
                                        Automatically tune and optimize the recommendation system over time as more data is collected.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-users fa-3x text-warning mb-3"></i>
                                    <h4>Better User Experience</h4>
                                    <p>
                                        Provide more relevant and engaging recommendations that lead to higher satisfaction.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h3>Statistical Significance</h3>
                </div>
                <div class="card-body">
                    <p>
                        To ensure that differences between variants are meaningful and not due to random chance, we use statistical significance testing. This involves:
                    </p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Hypothesis Testing</h5>
                            <p>
                                We start with the null hypothesis that there is no difference between variants. Then we calculate the probability (p-value) of observing the measured difference if the null hypothesis were true.
                            </p>
                            <p>
                                If this probability is less than a threshold (typically 5%), we reject the null hypothesis and conclude that the difference is statistically significant.
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5>Confidence Intervals</h5>
                            <p>
                                We also calculate confidence intervals to estimate the range of values within which the true difference between variants is likely to fall.
                            </p>
                            <p>
                                A 95% confidence interval means we are 95% confident that the true difference falls within that range. Wider intervals indicate less certainty in our estimates.
                            </p>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <strong>Note:</strong> For reliable results, we need a sufficient sample size. Tests typically run for several weeks to collect enough data for statistical significance.
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-warning">
                    <h3>Best Practices</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Test Duration</h5>
                            <p>
                                Tests should run for at least 2-4 weeks to account for weekly patterns in user behavior and to collect enough data for statistically significant results.
                            </p>
                            
                            <h5>Clear Objectives</h5>
                            <p>
                                Define specific metrics for success before starting the test. This helps avoid post-hoc rationalization or "cherry-picking" results.
                            </p>
                            
                            <h5>Control Group</h5>
                            <p>
                                Always include a control variant (current configuration) to serve as a baseline for comparison with new variants.
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5>Random Assignment</h5>
                            <p>
                                Ensure users are randomly assigned to variants to avoid selection bias and ensure representative samples.
                            </p>
                            
                            <h5>One Change at a Time</h5>
                            <p>
                                Focus each test on a specific hypothesis or change to clearly attribute any observed differences to that change.
                            </p>
                            
                            <h5>Documentation</h5>
                            <p>
                                Keep detailed records of each test, including hypotheses, variants, results, and decisions made based on those results.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="text-center mb-5">
        <a href="{{ url_for('ab_testing_dashboard') }}" class="btn btn-primary btn-lg">
            <i class="fas fa-tachometer-alt mr-2"></i> Go to A/B Testing Dashboard
        </a>
    </div>
</div>
{% endblock %}